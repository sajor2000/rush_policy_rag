# =============================================================================
# RUSH Policy RAG Agent - Environment Configuration Template
# =============================================================================
# Copy this file to .env and fill in your values.
# Never commit .env files with real credentials to version control.
# =============================================================================

# -----------------------------------------------------------------------------
# Azure AI Search (REQUIRED)
# -----------------------------------------------------------------------------
SEARCH_ENDPOINT=https://<your-search-service>.search.windows.net
SEARCH_API_KEY=                    # Leave empty to use DefaultAzureCredential

# -----------------------------------------------------------------------------
# Azure OpenAI (REQUIRED for vectorSemanticHybrid search)
# -----------------------------------------------------------------------------
AOAI_ENDPOINT=https://<your-aoai-resource>.openai.azure.com/
AOAI_API_KEY=
AOAI_CHAT_DEPLOYMENT=gpt-4.1
AOAI_EMBEDDING_DEPLOYMENT=text-embedding-3-large

# -----------------------------------------------------------------------------
# Azure Blob Storage (REQUIRED for PDF viewing feature)
# -----------------------------------------------------------------------------
# Option 1: Connection string (includes account key)
STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=<account>;AccountKey=<key>;EndpointSuffix=core.windows.net

# Option 2: Account URL with managed identity (production recommended)
# STORAGE_ACCOUNT_URL=https://<account>.blob.core.windows.net

# Container names (3-container architecture)
SOURCE_CONTAINER_NAME=policies-source    # Staging area for uploads
CONTAINER_NAME=policies-active           # Production container
# policies-archive is auto-managed        # For retired policies

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
USE_ON_YOUR_DATA=true              # Enable Azure OpenAI "On Your Data" vectorSemanticHybrid

# -----------------------------------------------------------------------------
# Cohere Rerank 3.5 (REQUIRED for healthcare RAG quality)
# -----------------------------------------------------------------------------
# Deploy Cohere Rerank 3.5 on Azure AI Foundry as serverless API
# Improves negation understanding (e.g., "Can MA accept verbal orders?" â†’ NOT authorized)
USE_COHERE_RERANK=true
COHERE_RERANK_ENDPOINT=https://<your-cohere-deployment>.models.ai.azure.com
COHERE_RERANK_API_KEY=
COHERE_RERANK_MODEL=cohere-rerank-v3-5
COHERE_RERANK_TOP_N=10             # Docs retained after rerank (default: 10)
COHERE_RERANK_MIN_SCORE=0.15       # Healthcare-calibrated threshold (default: 0.15)

# -----------------------------------------------------------------------------
# Production Settings
# -----------------------------------------------------------------------------
# Set to true in production to fail fast on missing configuration
FAIL_ON_MISSING_CONFIG=false

# REQUIRED in production - protects admin endpoints (/api/admin/*)
ADMIN_API_KEY=

# CORS origins (comma-separated, use HTTPS in production)
CORS_ORIGINS=http://localhost:3000,http://localhost:5000

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
BACKEND_PORT=8000
LOG_FORMAT=text                    # Use 'json' for production structured logging
MAX_REQUEST_SIZE=1048576           # 1MB default request body limit

# -----------------------------------------------------------------------------
# Azure AD Authentication (Optional)
# -----------------------------------------------------------------------------
# Enable to require Azure AD tokens for API access
REQUIRE_AAD_AUTH=false
AZURE_AD_TENANT_ID=
AZURE_AD_CLIENT_ID=
AZURE_AD_TOKEN_AUDIENCE=           # Defaults to AZURE_AD_CLIENT_ID if not set
AZURE_AD_ALLOWED_CLIENT_IDS=       # Comma-separated list of allowed app IDs

# -----------------------------------------------------------------------------
# Observability (Optional)
# -----------------------------------------------------------------------------
# Azure Application Insights connection string for distributed tracing
APPLICATIONINSIGHTS_CONNECTION_STRING=

# -----------------------------------------------------------------------------
# Frontend Configuration (for Next.js)
# -----------------------------------------------------------------------------
# Backend URL for API proxy routes
BACKEND_URL=http://localhost:8000

# Client-side API URL (must be accessible from browser)
# NEXT_PUBLIC_API_URL=http://localhost:8000
